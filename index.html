<html>
<meta charset="utf-8">

<head>
  <!-- meta data -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Lua Online</title>

  <meta name="author" content="Andrew Li">
  <meta name="description" content="Lua Online, Run Lua online now">
  <meta name="keywords" content="lua coding online">
  <meta property="og:image" content="img/ico.svg">

  <!-- Mini icon on tab -->
  <link rel="icon" href="img/ico.svg" type="image/ico">
  <!-- Initiates WebAssembly -->
  <script src="main.js"></script>
  <script>
    // TODO: change timer to run button
    let Module = undefined;
    let timer;
    function text_changed() {
      clearTimeout(timer);
      input = document.getElementById("edit").value;
      timer = setTimeout(function () {
        document.getElementById("result").innerHTML = "";
        Module.ccall("run_lua", 'number', ['string'], [input]);
      },
      750);
    }

    // init wasm module
    let ModuleConfig = {
      print: (function () {
        return function (text) {
          if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
          // console.log(text);

          if (text != "emsc")
            document.getElementById("result").innerHTML += "<br>\n" + text;
        };
      })(),
      printErr: function (text) {
        if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
        if (0) { // XXX disabled for safety typeof dump == 'function') {
          dump(text + '\n'); // fast, straight to the real console
        } else {
          console.error(text);
        }
      }
    };

    // initWasmModule function name configured in makefile
    initWasmModule(ModuleConfig).then((aModule) => {
      Module = aModule;
      text_changed();
    });
  </script>
</head>

<body>
  <div>
    <textarea id="edit" style="width: 800px; height: 480px;" onkeyup="text_changed();">

function hello_lua()
    print "Hello Lua!"
    print(_VERSION)
end

hello_lua()
return "this is return value"
</textarea>
    <div id="result" style="width: 800px; float: right"></div>
  </div>
</body>

</html>